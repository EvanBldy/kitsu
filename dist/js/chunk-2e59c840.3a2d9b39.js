(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e59c840"],{"08cd":function(t,e,i){},"99a3":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"fixed-page columns"},[i("div",{staticClass:"page column main-column"},[i("div",{staticClass:"page-header pa1 mb0"},[t.task?i("div",{staticClass:"flexrow header-title"},[t.taskType?i("task-type-name",{staticClass:"flexrow-item task-type block",attrs:{"task-type":t.taskType,"production-id":t.currentProduction.id}}):t._e(),i("span",{staticClass:"flexrow-item ml2"},[i("entity-thumbnail",{staticClass:"entity-thumbnail",attrs:{entity:t.taskPreviews&&t.taskPreviews.length>0?{preview_file_id:t.taskPreviews[0].id}:{},"empty-width":100,"empty-height":60,width:100,"with-link":!1}})],1),i("h1",{staticClass:"title flexrow-item"},[i("router-link",{attrs:{to:t.taskEntityPath}},[i("page-title",{attrs:{text:t.task?t.title:"Loading...",bold:""}})],1)],1),i("div",{staticClass:"flexrow-item flexrow block"},[i("span",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.$t("tasks.current_status"))+" ")]),t.task?i("validation-tag",{staticClass:"is-medium flexrow-item",attrs:{task:t.task,"is-static":!0}}):t._e(),t.task.assignees.length>0?i("span",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.$t("tasks.fields.assignees"))+": ")]):t._e(),t._l(t.task.assignees,(function(e){return i("span",{key:e,staticClass:"flexrow-item avatar-wrapper"},[i("people-avatar",{key:e,staticClass:"flexrow-item",attrs:{person:t.personMap.get(e),size:30,"font-size":16}})],1)})),i("div",{staticClass:"flexrow-item"},[t._v(" "+t._s(t.$t("tasks.fields.priority"))+": "+t._s(t.formatPriority(t.task.priority))+" ")]),t.isAssigned?t._e():i("subscribe-button",{staticClass:"flexrow-item action-button",attrs:{subscribed:t.isAssigned||t.isSubscribed},on:{click:t.toggleSubscribe}})],2)],1):t._e()]),i("div",{ref:"task-columns",staticClass:"task-columns"},[i("div",{staticClass:"task-column preview-column"},[i("div",{staticClass:"preview-column-content block"},[i("div",{staticClass:"flexrow preview-header"},[t.isPreviews?i("div",{staticClass:"flexrow-item"},[i("combobox-styled",{staticClass:"preview-combo flexrow-item",attrs:{options:t.previewOptions},model:{value:t.selectedPreviewId,callback:function(e){t.selectedPreviewId=e},expression:"selectedPreviewId"}})],1):i("div",[i("em",[t._v(" "+t._s(t.$t("tasks.no_preview"))+" ")])]),t.isPreviewButtonVisible?i("div",{staticClass:"set-main-preview flexrow-item flexrow pull-right"},[t.isPreviews&&t.isCurrentUserManager?i("button",{class:{button:!0,"flexrow-item":!0,"is-loading":t.loading.setPreview},on:{click:t.setPreview}},[i("image-icon",{staticClass:"icon"}),i("span",{staticClass:"text"},[t._v(" "+t._s(t.$t("tasks.set_preview"))+" ")])],1):t._e(),t.errors.setPreview?i("span",{staticClass:"error flexrow-item"},[t._v(" "+t._s(t.$t("tasks.set_preview_error"))+" ")]):t._e()]):t._e(),t.task&&t.task.entity&&t.task.entity.preview_file_id===t.currentPreviewId?i("div",{staticClass:"set-main-preview flexrow-item pull-right"},[i("em",[t._v(t._s(t.$t("tasks.set_preview_done")))])]):t._e()]),i("div",{staticClass:"preview-area mt1"},[t.isPreviews?i("div",[t.currentPreview?i("preview-player",{ref:"preview-player",attrs:{previews:t.currentPreview.previews,"task-type-map":t.taskTypeMap,"entity-preview-files":t.taskEntityPreviews,"read-only":t.isCurrentUserArtist,"last-preview-files":t.lastFivePreviews,task:t.task,"extra-wide":!0},on:{"annotation-changed":t.onAnnotationChanged,"add-extra-preview":t.onAddExtraPreviewClicked,"remove-extra-preview":t.onRemoveExtraPreviewClicked,"change-current-preview":t.changeCurrentPreview,"time-updated":t.onTimeUpdated}}):t._e()],1):t._e()])]),i("div",{staticClass:"flexrow-item block mt1 mr0 info-block"},[i("page-subtitle",{attrs:{text:t.$t("main.info")}}),i("div",{staticClass:"table-body mt1"},[t.task?i("table",{staticClass:"datatable no-header"},[i("tbody",{staticClass:"table-body"},[i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(t.$t("tasks.fields.estimation")))]),i("td",[t._v(t._s(t.task.estimation))])]),i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(t.$t("tasks.fields.duration")))]),i("td",[t._v(t._s(t.formatDuration(t.task.duration)))])]),i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(t.$t("tasks.fields.retake_count")))]),i("td",[t._v(t._s(t.task.retake_count))])]),i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(t.$t("tasks.fields.start_date")))]),i("td",[t._v(t._s(t.formatSimpleDate(t.task.start_date)))])]),i("tr",{staticClass:"datatable-row"},[i("td",{staticClass:"field-label"},[t._v(t._s(t.$t("tasks.fields.due_date")))]),i("td",[t._v(t._s(t.formatSimpleDate(t.task.due_date)))])])])]):t._e()])],1),i("div",{staticClass:"pa2"})]),i("div",{staticClass:"task-column comments-column"},[t.task?i("div",[i("div",[t.isCommentingAllowed?i("add-comment",{ref:"add-comment",attrs:{"is-error":t.errors.addComment,"is-max-retakes-error":t.errors.addCommentMaxRetakes,"is-loading":t.loading.addComment,"is-movie":t.isMovie,user:t.user,team:t.currentTeam,task:t.task,"task-status":t.taskStatusForCurrentUser,"preview-forms":t.previewForms,fps:parseInt(t.currentFps),time:t.currentTime,revision:t.currentRevision},on:{"add-comment":t.addComment,"add-preview":t.onAddPreviewClicked,"duplicate-comment":t.onDuplicateComment,"file-drop":t.selectFile,"clear-files":t.clearPreviewFiles,"annotation-snapshots-requested":t.extractAnnotationSnapshots,"remove-preview":t.onPreviewFormRemoved}}):t._e(),t.taskComments&&t.taskComments.length>0?i("div",{staticClass:"comments"},t._l(t.taskComments,(function(e,r){return i("comment",{key:e.id,attrs:{comment:e,task:t.task,highlighted:!1,"current-user":t.user,editable:e.person&&t.user.id===e.person.id||t.isCurrentUserAdmin,"is-first":0===r,"is-last":r===t.pinnedCount,"is-change":t.isStatusChange(r)},on:{"ack-comment":t.ackComment,"pin-comment":t.onPinComment,"edit-comment":t.onEditComment,"delete-comment":t.onDeleteComment,"checklist-updated":t.saveComment,"time-code-clicked":t.timeCodeClicked}})})),1):i("div",{staticClass:"no-comment"},[i("em",[t._v(" "+t._s(t.$t("tasks.no_comment"))+" ")])])],1)]):i("div",{staticClass:"has-text-centered"},[i("spinner")],1)])]),i("add-preview-modal",{ref:"add-preview-modal",attrs:{active:t.modals.addPreview,"is-loading":t.loading.addPreview,"is-error":t.errors.addPreview,"form-data":t.addPreviewFormData,title:t.task?t.task.entity_name+" / "+t.taskTypeMap.get(t.task.task_type_id).name:""},on:{cancel:function(e){t.modals.addPreview=!1},fileselected:t.selectFile,confirm:t.closeAddPreviewModal}}),i("add-preview-modal",{ref:"add-extra-preview-modal",attrs:{active:t.modals.addExtraPreview,"is-loading":t.loading.addExtraPreview,"is-error":t.errors.addExtraPreview,"form-data":t.addExtraPreviewFormData,title:t.task?t.task.entity_name+" / "+t.taskTypeMap.get(t.task.task_type_id).name:""},on:{cancel:t.hideExtraPreviewModal,fileselected:t.selectFile,confirm:t.createExtraPreview}}),i("edit-comment-modal",{attrs:{active:t.modals.editComment,"is-loading":t.loading.editComment,"is-error":t.errors.editComment,"comment-to-edit":t.commentToEdit,team:t.currentTeam},on:{confirm:t.confirmEditTaskComment,cancel:t.onCancelEditComment}}),i("delete-modal",{attrs:{active:t.modals.deleteComment,"is-loading":t.loading.deleteComment,"is-error":t.errors.deleteComment,text:t.$t("tasks.delete_comment"),"error-text":t.$t("tasks.delete_comment_error")},on:{confirm:t.confirmDeleteTaskComment,cancel:t.onCancelDeleteComment}}),i("delete-modal",{attrs:{active:t.modals.deleteExtraPreview,"is-loading":t.loading.deleteExtraPreview,"is-error":t.errors.deleteExtraPreview,text:t.$t("tasks.delete_preview"),"error-text":t.$t("tasks.delete_preview_error")},on:{cancel:t.hideRemoveExtraPreviewModal,confirm:t.confirmDeleteTaskPreview}})],1)])},n=[],s=i("2f62"),a=i("0a35"),o=i("9d8b"),d=i("1b25"),c=i("31f2"),u=i("f90a"),l=i("6be5"),m=i("ee35"),h=i("8bd9"),v=i("9751"),f=i("5f48"),p=i("5b23"),k=i("bb21"),w=i("8d07"),g=i("8751"),C=i("eb8c"),y=i("be83"),P=i("d228"),_=i("274f"),b=i("fe13"),x=i("6aac");function T(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */T=function(){return t};var t={},e=Object.prototype,i=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function o(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{o({},"")}catch(E){o=function(t,e,i){return t[e]=i}}function d(t,e,i,r){var n=e&&e.prototype instanceof l?e:l,s=Object.create(n.prototype),a=new _(r||[]);return s._invoke=function(t,e,i){var r="suspendedStart";return function(n,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw s;return x()}for(i.method=n,i.arg=s;;){var a=i.delegate;if(a){var o=C(a,i);if(o){if(o===u)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var d=c(t,e,i);if("normal"===d.type){if(r=i.done?"completed":"suspendedYield",d.arg===u)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(r="completed",i.method="throw",i.arg=d.arg)}}}(t,i,a),s}function c(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(E){return{type:"throw",arg:E}}}t.wrap=d;var u={};function l(){}function m(){}function h(){}var v={};o(v,n,(function(){return this}));var f=Object.getPrototypeOf,p=f&&f(f(b([])));p&&p!==e&&i.call(p,n)&&(v=p);var k=h.prototype=l.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){o(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){function r(n,s,a,o){var d=c(t[n],t,s);if("throw"!==d.type){var u=d.arg,l=u.value;return l&&"object"==I(l)&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,o)}),(function(t){r("throw",t,a,o)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,o)}))}o(d.arg)}var n;this._invoke=function(t,i){function s(){return new e((function(e,n){r(t,i,e,n)}))}return n=n?n.then(s,s):s()}}function C(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,C(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=c(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,u;var n=r.arg;return n?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function y(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(y,this),this.reset(!0)}function b(t){if(t){var e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,s=function e(){for(;++r<t.length;)if(i.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return s.next=s}}return{next:x}}function x(){return{value:void 0,done:!0}}return m.prototype=h,o(k,"constructor",h),o(h,"constructor",m),m.displayName=o(h,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,o(t,a,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},w(g.prototype),o(g.prototype,s,(function(){return this})),t.AsyncIterator=g,t.async=function(e,i,r,n,s){void 0===s&&(s=Promise);var a=new g(d(e,i,r,n),s);return t.isGeneratorFunction(i)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(k),o(k,a,"Generator"),o(k,n,(function(){return this})),o(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var r=e.pop();if(r in t)return i.value=r,i.done=!1,i}return i.done=!0,i}},t.values=b,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(i,r){return a.type="throw",a.arg=t,e.next=i,r&&(e.method="next",e.arg=void 0),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var o=i.call(s,"catchLoc"),d=i.call(s,"finallyLoc");if(o&&d){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=t,a.arg=e,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),P(i),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;P(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:b(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),u}},t}function E(t,e,i,r,n,s,a){try{var o=t[s](a),d=o.value}catch(c){return void i(c)}o.done?e(d):Promise.resolve(d).then(r,n)}function S(t){return function(){var e=this,i=arguments;return new Promise((function(r,n){var s=t.apply(e,i);function a(t){E(s,r,n,a,o,"next",t)}function o(t){E(s,r,n,a,o,"throw",t)}a(void 0)}))}}function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function L(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function M(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?L(Object(i),!0).forEach((function(e){$(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function $(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var A={name:"task",mixins:[c["a"],u["a"]],components:{AddComment:l["a"],AddPreviewModal:m["a"],ComboboxStyled:v["a"],Comment:h["a"],DeleteModal:f["a"],EditCommentModal:p["a"],EntityThumbnail:k["a"],ImageIcon:a["G"],PageSubtitle:g["a"],PageTitle:w["a"],PeopleAvatar:C["a"],PreviewPlayer:x["a"],Spinner:y["a"],SubscribeButton:P["a"],TaskTypeName:_["a"],ValidationTag:b["a"]},data:function(){return{previewForms:[],currentTime:0,selectedTab:"validation",taskLoading:{isLoading:!0,isError:!1},modals:{addPreview:!1,addExtraPreview:!1,deleteExtraPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},loading:{addComment:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},errors:{addComment:!1,addCommentMaxRetakes:!1,addPreview:!1,addExtraPreview:!1,setPreview:!1,deleteTask:!1,deleteComment:!1,editComment:!1},addPreviewFormData:null,addExtraPreviewFormData:null,task:null,taskComments:[],taskPreviews:[],commentToEdit:null,isSubscribed:!1,selectedPreviewId:null}},created:function(){this.clearSelectedTasks()},mounted:function(){var t=this;this.loadTaskData().then((function(){t.reset()})),this.$nextTick((function(){t.$refs["task-columns"]&&(t.$refs["task-columns"].scrollTop=100,window.scrollTo(0,0))}))},beforeDestroy:function(){if(this.$refs["add-comment"]){var t=this.getTask(),e="".concat(this.$refs["add-comment"].text),i=d["a"].getTaskDraft(t.id);e===i||this.$options.drafted||d["a"].setTaskDraft(t.id,e)}},computed:M(M({},Object(s["c"])(["currentEpisode","currentProduction","displayedShots","displayedAssets","getTaskComments","getTaskPreviews","getTaskComment","isCurrentUserAdmin","isCurrentUserArtist","isCurrentUserSupervisor","isCurrentUserClient","isCurrentUserManager","isSingleEpisode","isTVShow","personMap","productionMap","route","taskEntityPreviews","taskStatus","taskStatusForCurrentUser","taskMap","taskTypeMap","user"])),{},{previewOptions:function(){return this.taskPreviews.map((function(t){return{label:"v".concat(t.revision),value:t.id}}))},isPreviewButtonVisible:function(){return this.isCurrentUserManager&&this.task&&this.task.entity&&this.task.entity.preview_file_id!==this.currentPreviewId&&["png","mp4"].includes(this.extension)},isMovie:function(){return"mp4"===this.extension},extension:function(){return this.currentPreview?this.currentPreview.extension:""},currentPreviewId:function(){return this.currentPreview?this.currentPreview.id:""},currentPreview:function(){if(this.isPreviews){var t=this.taskPreviews[0],e=this.route.params.preview_id;return this.selectedPreviewId&&(t=this.taskPreviews.find((function(t){return t.id===e}))),t}return null},currentFps:function(){return this.productionMap.get(this.task.project_id).fps||"25"},currentRevision:function(){return this.currentPreview?this.currentPreview.revision:0},isCommentingAllowed:function(){var t=this;return this.isCurrentUserManager||this.isCurrentUserClient||this.task.assignees.find((function(e){return e===t.user.id}))},taskTypeBorder:function(){var t="transparent";return this.task&&(t=this.task.task_type_color),{"border-left":"4px solid ".concat(t)}},deleteTaskPath:function(){return this.taskPath(this.task,"task-delete")},isPreviews:function(){return this.taskPreviews&&this.taskPreviews.length>0},taskEntityPath:function(){if(this.task){var t=this.currentEpisode?this.currentEpisode.id:this.$route.params.episode_id;return Object(o["h"])(this.task,t)}return{name:"open-productions"}},lastFivePreviews:function(){return this.taskPreviews?this.taskPreviews.slice(0,5):[]},entityList:function(){var t=this,e=this.displayedShots.find((function(e){return e.id===t.task.entity_id}));return e?this.displayedShots:this.displayedAssets},previousEntity:function(){var t=this;if(!this.task)return{name:"open-productions"};var e=function(){var e=t.task.task_type_id,i=t.entityList.findIndex((function(e){return e.id===t.task.entity_id})),r=!1,n=i-1;n<0&&(n=t.entityList.length-1);var s=null;while(!s){if(t.entityList[n]){var a=t.entityList[n];s=a.tasks.find((function(i){var r=t.taskMap.get(s);return!!r&&r.task_type_id===e}))}else s=t.task.id;if(!s&&(n--,n<0)){if(n=t.entityList.length,r)return{v:null};r=!0}}return{v:t.taskPath({id:s})}}();return"object"===I(e)?e.v:void 0},nextEntity:function(){var t=this;if(!this.task)return{name:"open-productions"};var e=function(){var e=t.task.task_type_id,i=!1,r=t.entityList.findIndex((function(e){return e.id===t.task.entity_id})),n=r+1;n>=t.entityList.length&&(n=0);var s=null;while(!s){if(t.entityList[n]){var a=t.entityList[n];s=a.tasks.find((function(i){var r=t.taskMap.get(s);return!!r&&r.task_type_id===e}))}else s=t.task.id;if(!s&&(n++,n>=t.entityList.length)){if(n=0,i)return{v:null};i=!0}}return{v:t.taskPath({id:s})}}();return"object"===I(e)?e.v:void 0},title:function(){if(this.task){var t=this.task.entity_type_name,e=this.task.full_entity_name||this.task.entity_name;return this.isTVShow&&"Shot"===t&&(e=e.split("/").splice(1).join("/")),"".concat(e)}return"Loading..."},windowTitle:function(){if(this.task){var t=this.task.task_type_name;return"".concat(this.title," / ").concat(t)}return"Loading..."},deleteText:function(){if(this.task){var t=this.taskTypeMap.get(this.task.task_type_id);return this.$t("main.delete_text",{name:"".concat(this.task.entity_name," / ").concat(t.name)})}return""},isAssigned:function(){var t=this;return!!this.task&&this.task.assignees.some((function(e){return e===t.user.id}))},taskType:function(){return this.task?this.taskTypeMap.get(this.task.task_type_id):null},currentTeam:function(){var t=this;return this.currentProduction.team.map((function(e){return t.personMap.get(e)}))},pinnedCount:function(){return this.taskComments.filter((function(t){return t.pinned})).length}}),methods:M(M({},Object(s["b"])(["addAttachmentToComment","ackComment","addCommentPreview","addCommentExtraPreview","commentTask","commentTaskWithPreview","changeCommentPreview","clearSelectedTasks","deleteAttachment","deleteTask","deleteTaskPreview","deleteTaskComment","editTaskComment","loadEpisodes","loadTask","loadShots","loadAssets","loadPreviewFileFormData","loadTaskComments","loadTaskSubscribed","refreshComment","refreshPreview","pinComment","subscribeToTask","setCurrentEpisode","unsubscribeFromTask","updatePreviewAnnotation"])),{},{loadTaskData:function(){var t=this,e=this.getCurrentTask();if(e){var i=this.route.params.task_id;return this.task=e,this.loadTaskComments({taskId:i,entityId:e.entity_id}).then((function(){return t.loadTaskSubscribed({taskId:i})})).then((function(e){return t.isSubscribed=e,t.reset(),Promise.resolve()})).catch((function(e){console.error(e),t.taskLoading.isError=!0}))}return this.taskLoading={isLoading:!0,isError:!1},this.loadTask({taskId:this.route.params.task_id}).then((function(e){var i=function(e){t.loadAssets().then(e)};"Shot"===e.entity_type_name&&(i=function(i){t.loadEpisodes().then((function(){t.isTVShow&&t.setCurrentEpisode(e.episode.id),t.loadShots(i)})).catch(i)}),i((function(){return t.task=e,t.loadTaskComments({taskId:e.id,entityId:e.entity_id}).then((function(){return t.loadTaskSubscribed({taskId:e.id})})).then((function(e){return t.isSubscribed=e,t.reset(),t.taskLoading={isLoading:!1,isError:!1},Promise.resolve()})).catch((function(e){console.error(e),t.taskLoading={isLoading:!1,isError:!0}}))}))}))},getCurrentTask:function(){return this.taskMap.get(this.route.params.task_id)},getCurrentComment:function(){if(this.route.params.comment_id)return this.getTaskComment(this.route.params.task_id,this.route.params.comment_id)},getCurrentTaskComments:function(){return this.getTaskComments(this.route.params.task_id)},getCurrentTaskPreviews:function(){return this.getTaskPreviews(this.route.params.task_id)},addComment:function(t,e,i,r){var n=this,s={taskId:this.task.id,taskStatusId:r,comment:t,checklist:i,attachment:e},a="commentTask";this.previewForms.length>0&&(a="commentTaskWithPreview"),this.loading.addComment=!0,this.errors.addComment=!1,this.errors.addCommentMaxRetakes=!1,this.$store.dispatch(a,s).then((function(){d["a"].clearTaskDraft(n.task.id),n.reset(),n.previewForms=[],n.loading.addComment=!1})).catch((function(t){console.error(t),n.errors.addComment=!0,n.loading.addComment=!1;var e=t.response&&t.response.body.message&&t.response.body.message.indexOf("retake")>0;n.errors.addComment=!e,n.errors.addCommentMaxRetakes=e}))},reset:function(){var t=this;this.resetModals(),this.resetPreview(),this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews(),this.task=this.getCurrentTask(),this.resetDraft(),setTimeout((function(){t.$route.params.preview_id&&(t.selectedPreviewId=t.$route.params.preview_id)}),1e3)},selectFile:function(t){this.loadPreviewFileFormData(t),this.previewForms=this.previewForms.concat(t)},clearPreviewFiles:function(){this.previewForms=[]},isHighlighted:function(t){return t.preview&&t.preview.id===this.currentPreviewId},createExtraPreview:function(){var t=this,e=this.taskPreviews,i=e.length>0?e[0]:null;this.errors.addExtraPreview=!1,this.loading.addExtraPreview=!0;var r=this.getCurrentTaskComments().find((function(t){return t.previews.findIndex((function(t){return t.id===i.id}))>=0}));this.addCommentExtraPreview({taskId:this.task.id,previewId:this.currentPreview.id,commentId:r.id}).then((function(){t.loading.addExtraPreview=!1,t.modals.addExtraPreview=!1,t.$refs["add-extra-preview-modal"].reset(),setTimeout((function(){t.$refs["preview-player"].displayLast()}),0)})).catch((function(e){console.error(e),t.errors.addExtraPreview=!0,t.loading.addExtraPreview=!1}))},resetPreview:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.taskPreviews||[],i=e.length>0?e[0]:null;this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews(),i&&t&&this.$router.push(this.previewPath(i.id))},setPreview:function(){var t=this;this.loading.setPreview=!0,this.errors.setPreview=!1,this.$store.dispatch("setPreview",{taskId:this.task.id,entityId:this.task.entity.id,previewId:this.currentPreviewId}).then((function(){t.loading.setPreview=!1})).catch((function(e){console.error(e),t.errors.setPreview=!0}))},saveComment:function(t,e){this.editTaskComment({taskId:this.task.id,comment:t,checklist:e})},confirmDeleteTaskComment:function(){var t=this;this.loading.deleteComment=!0,this.errors.deleteComment=!1;var e=this.commentToEdit.id;this.deleteTaskComment({taskId:this.task.id,commentId:e}).then((function(){t.loading.deleteComment=!1,t.reset(),t.isPreviews&&t.resetPreview(),t.modals.deleteComment=!1})).catch((function(e){console.error(e),t.loading.deleteComment=!1,t.errors.deleteComment=!0}))},confirmDeleteTaskPreview:function(){var t=this;this.loading.deleteExtraPreview=!0,this.errors.deleteExtraPreview=!1;var e=this.currentPreviewId,i=this.getCurrentTaskComments().find((function(t){return t.previews.findIndex((function(t){return t.id===e}))>=0}));this.$refs["preview-player"].displayFirst(),this.deleteTaskPreview({taskId:this.task.id,commentId:i.id,previewId:this.currentExtraPreviewId}).then((function(){t.loading.deleteExtraPreview=!1,t.resetPreview(),t.hideRemoveExtraPreviewModal()})).catch((function(e){console.error(e),t.loading.deleteExtraPreview=!1,t.errors.deleteExtraPreview=!0}))},onPreviewAdded:function(t){var e=t.task_id,i=t.comment_id,r=t.preview_file_id,n=t.revision,s=t.extension,a=this.$store.getters.getTaskComment(e,i);this.task&&a&&(0===a.previews.length||a.previews[0].id!==r)&&e===this.task.id&&(this.$store.commit("ADD_PREVIEW_END",{preview:{id:r,revision:n,extension:s},taskId:e,commentId:i,comment:a}),this.resetPreview())},toggleSubscribe:function(){this.task&&!this.isAssigned&&(this.isSubscribed?(this.unsubscribeFromTask(this.task.id),this.isSubscribed=!1):(this.subscribeToTask(this.task.id),this.isSubscribed=!0))},taskPath:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"task";t?(t.project_id=this.task.project_id,t.episode_id=this.task.episode_id):t=this.task;var i={name:"open-productions"};return t&&(i={name:e,params:{production_id:t.project_id,task_id:t.id}},this.isTVShow&&this.currentEpisode&&(i.name="episode-".concat(e),i.params.episode_id=t.episode_id||this.currentEpisode.id)),i},previewPath:function(t){var e=this.taskPath(this.task,"task-preview");return e.params&&(e.params.preview_id=t),e},onAnnotationChanged:function(t){var e=t.preview,i=t.additions,r=t.deletions,n=t.updates,s=this.task.id;this.updatePreviewAnnotation({taskId:s,preview:e,additions:i,deletions:r,updates:n})},onAddExtraPreviewClicked:function(){this.modals.addExtraPreview=!0},onRemoveExtraPreviewClicked:function(t){this.showRemoveExtraPreviewModal(t)},hideExtraPreviewModal:function(){this.modals.addExtraPreview=!1},showRemoveExtraPreviewModal:function(t){this.currentExtraPreviewId=t.id,this.modals.deleteExtraPreview=!0},hideRemoveExtraPreviewModal:function(){this.modals.deleteExtraPreview=!1},onAddPreviewClicked:function(){this.modals.addPreview=!0},closeAddPreviewModal:function(){this.modals.addPreview=!1},onDuplicateComment:function(t){this.$refs["add-comment"].setValue(t)},onPinComment:function(t){this.pinComment(t)},onEditComment:function(t){this.commentToEdit=t,this.modals.editComment=!0},onDeleteComment:function(t){this.commentToEdit=t,this.modals.deleteComment=!0},onCancelEditComment:function(t){this.modals.editComment=!1},onCancelDeleteComment:function(t){this.modals.deleteComment=!1},onTimeUpdated:function(t){this.currentTime=t},onPreviewFormRemoved:function(t){this.previewForms=this.previewForms.filter((function(e){return e!==t}))},changeCurrentPreview:function(t){this.$router.push(this.previewPath(t.id))},onRemoteAcknowledge:function(t,e){if(this.task){var i=this.taskComments.find((function(e){return e.id===t.comment_id})),r=this.personMap.get(t.person_id);i&&r&&(this.user.id===r.id?("ack"===e&&!i.acknowledgements.includes(r.id)||"unack"===e&&i.acknowledgements.includes(r.id))&&this.$store.commit("ACK_COMMENT",{comment:i,user:r}):this.$store.commit("ACK_COMMENT",{comment:i,user:r}))}},isStatusChange:function(t){var e=this.taskComments,i=e[t];return t===e.length-1||i.task_status_id!==e[t+1].task_status_id},timeCodeClicked:function(t){var e=this,i=t.versionRevision,r=(t.minutes,t.seconds,t.milliseconds,t.frame);this.changeCurrentPreview(this.taskPreviews.find((function(t){return t.revision===parseInt(i)}))),setTimeout((function(){e.$refs["preview-player"].setCurrentFrame(r),e.$refs["preview-player"].focus()}),20)},extractAnnotationSnapshots:function(){var t=this;return S(T().mark((function e(){var i;return T().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$refs["add-comment"].showAnnotationLoading(),e.next=3,t.$refs["preview-player"].extractAnnotationSnapshots();case 3:return i=e.sent,t.$refs["add-comment"].setAnnotationSnapshots(i),t.$refs["add-comment"].hideAnnotationLoading(),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})))()},isPreviewPlayerReadOnly:function(){if(this.task){if(this.isCurrentUserManager||this.isCurrentUserClient)return!1;if(this.isCurrentUserSupervisor){if(0===this.user.departments.length)return!1;var t=this.taskTypeMap.get(this.task.task_type_id);return!(t.department_id&&this.user.departments.includes(t.department_id))}}return!0}}),watch:{$route:function(){this.$route.params.task_id!==this.task.id&&this.loadTaskData()},selectedPreviewId:function(){this.task&&this.$router.push(this.previewPath(this.selectedPreviewId))}},socket:{events:{"preview-file:add-file":function(t){this.onPreviewAdded(t)},"comment:acknowledge":function(t){this.onRemoteAcknowledge(t,"ack")},"comment:unacknowledge":function(t){this.onRemoteAcknowledge(t,"unack")},"preview-file:update":function(t){var e=this.taskComments.find((function(e){return e.previews&&e.previews.length>0&&e.previews[0].id===t.preview_file_id}));e&&this.task&&this.refreshPreview({taskId:this.task.id,previewId:t.preview_file_id}).then((function(t){e.previews[0].validation_status=t.validation_status}))},"comment:new":function(t){var e=this;setTimeout((function(){e.getCurrentTaskComments().length!==e.taskComments.length&&(e.taskComments=e.getCurrentTaskComments(),e.taskPreviews=e.getCurrentTaskPreviews())}),1e3)},"comment:reply":function(t){if(this.task){var e=this.taskComments.find((function(e){return e.id===t.comment_id}));if(e){e.replies||(e.replies=[]);var i=e.replies.find((function(e){return e.id===t.reply_id}));i||this.refreshComment({taskId:this.task.id,commentId:t.comment_id}).then((function(t){e.replies=t.replies})).catch(console.error)}}},"comment:delete":function(t){var e=this.getTask();if(e){var i=this.getComments(),r=i.find((function(e){return e.id===t.comment_id}));r&&(this.$store.commit("REMOVE_TASK_COMMENT",{task:e,comment:r}),this.taskComments=this.getCurrentTaskComments(),this.taskPreviews=this.getCurrentTaskPreviews())}},"comment:delete-reply":function(t){if(this.task){var e=this.taskComments.find((function(e){return e.id===t.comment_id}));e&&(e.replies||(e.replies=[]),this.$store.commit("REMOVE_REPLY_FROM_COMMENT",{comment:e,reply:{id:t.reply_id}}))}},"preview-file:annotation-update":function(t){var e=this,i=this.$refs["preview-player"],r=i.isValidPreviewModification(t.preview_file_id,t.updated_at);r&&this.refreshPreview({previewId:i.currentPreview.id,taskId:i.currentPreview.task_id}).then((function(t){i.notSaved||(e.taskPreviews=e.getCurrentTaskPreviews(),e.$nextTick((function(){i.reloadAnnotations(),i.loadAnnotation()})))}))}}},metaInfo:function(){var t="Loading task... - Kitsu";if(this.task){var e=this.taskTypeMap.get(this.task.task_type_id).name;t="".concat(this.title," / ").concat(e," - Kitsu")}return{title:t}}},O=A,F=(i("bf40"),i("2877")),D=Object(F["a"])(O,r,n,!1,null,"5e921929",null);e["default"]=D.exports},bf40:function(t,e,i){"use strict";i("08cd")}}]);
//# sourceMappingURL=chunk-2e59c840.3a2d9b39.js.map