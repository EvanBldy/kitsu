{"version":3,"sources":["webpack:///./src/components/pages/ProductionSchedule.vue?9bad","webpack:///./src/components/pages/ProductionSchedule.vue?2ca1","webpack:///src/components/pages/ProductionSchedule.vue","webpack:///./src/components/pages/ProductionSchedule.vue?a662","webpack:///./src/components/pages/ProductionSchedule.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","$t","attrs","locale","days","model","value","callback","$$v","selectedStartDate","expression","selectedEndDate","directives","name","rawName","isCurrentUserAdmin","overallManDays","zoomOptions","zoomLevel","startDate","endDate","scheduleItems","loading","schedule","errors","on","scheduleItemChanged","estimationChanged","changeZoom","expandTaskTypeElement","currentTask","_e","staticRenderFns","components","ComboboxNumber","Datepicker","Schedule","TaskInfo","TextField","data","label","mounted","reset","computed","mapGetters","user","methods","mapActions","loadData","loadScheduleItems","currentProduction","then","item","color","for_entity","priority","editable","expanded","route","taskType","children","catch","console","event","wheelDelta","start_date","parseDate","end_date","man_days","toDate","convertScheduleItems","taskTypeElement","map","parentElement","scheduleItem","production","action","isTVShow","parameters","saveScheduleItem","isAfter","minDate","isBefore","maxDate","getMinDate","clone","getMaxDate","socket","watch","editProduction","metaInfo","title","component"],"mappings":"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","file":"js/chunk-591211b8.05a590b2.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProductionSchedule.vue?vue&type=style&index=0&id=81aeeeaa&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"columns fixed-page\"},[_c('div',{staticClass:\"column main-column\"},[_c('div',{staticClass:\"flexrow project-dates\"},[_c('div',{staticClass:\"flexrow-item\"},[_c('label',{staticClass:\"label\"},[_vm._v(\" \"+_vm._s(_vm.$t('main.start_date'))+\" \")]),_c('datepicker',{attrs:{\"wrapper-class\":\"datepicker\",\"input-class\":\"date-input input\",\"language\":_vm.locale,\"disabled-dates\":{ days: [6, 0] },\"monday-first\":true,\"format\":\"yyyy-MM-dd\"},model:{value:(_vm.selectedStartDate),callback:function ($$v) {_vm.selectedStartDate=$$v},expression:\"selectedStartDate\"}})],1),_c('div',{staticClass:\"flexrow-item field\"},[_c('label',{staticClass:\"label\"},[_vm._v(\" \"+_vm._s(_vm.$t('main.end_date'))+\" \")]),_c('datepicker',{attrs:{\"wrapper-class\":\"datepicker\",\"input-class\":\"date-input input\",\"language\":_vm.locale,\"disabled-dates\":{ days: [6, 0] },\"monday-first\":true,\"format\":\"yyyy-MM-dd\"},model:{value:(_vm.selectedEndDate),callback:function ($$v) {_vm.selectedEndDate=$$v},expression:\"selectedEndDate\"}})],1),_c('text-field',{directives:[{name:\"show\",rawName:\"v-show\",value:(false),expression:\"false\"}],staticClass:\"flexrow-item overall-man-days\",attrs:{\"type\":\"number\",\"label\":_vm.$t('schedule.overall_man_days'),\"disabled\":!_vm.isCurrentUserAdmin},model:{value:(_vm.overallManDays),callback:function ($$v) {_vm.overallManDays=$$v},expression:\"overallManDays\"}}),_c('combobox-number',{staticClass:\"flexrow-item zoom-level\",attrs:{\"label\":_vm.$t('schedule.zoom_level'),\"options\":_vm.zoomOptions},model:{value:(_vm.zoomLevel),callback:function ($$v) {_vm.zoomLevel=$$v},expression:\"zoomLevel\"}})],1),_c('schedule',{attrs:{\"start-date\":_vm.startDate,\"end-date\":_vm.endDate,\"hierarchy\":_vm.scheduleItems,\"zoom-level\":_vm.zoomLevel,\"is-loading\":_vm.loading.schedule,\"is-error\":_vm.errors.schedule,\"hide-man-days\":true},on:{\"item-changed\":_vm.scheduleItemChanged,\"estimation-changed\":_vm.estimationChanged,\"change-zoom\":_vm.changeZoom,\"root-element-expanded\":_vm.expandTaskTypeElement}})],1),(_vm.currentTask)?_c('div',{staticClass:\"column side-column is-hidden-mobile hide-small-screen\"},[_c('task-info',{attrs:{\"task\":_vm.currentTask,\"is-loading\":false}})],1):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n<div\n  class=\"columns fixed-page\"\n>\n  <div\n    class=\"column main-column\"\n  >\n    <div class=\"flexrow project-dates\">\n      <div class=\"flexrow-item\">\n        <label class=\"label\">\n          {{ $t('main.start_date') }}\n        </label>\n        <datepicker\n          wrapper-class=\"datepicker\"\n          input-class=\"date-input input\"\n          :language=\"locale\"\n          :disabled-dates=\"{ days: [6, 0] }\"\n          :monday-first=\"true\"\n          format=\"yyyy-MM-dd\"\n          v-model=\"selectedStartDate\"\n        />\n      </div>\n      <div class=\"flexrow-item field\">\n        <label class=\"label\">\n          {{ $t('main.end_date') }}\n        </label>\n        <datepicker\n          wrapper-class=\"datepicker\"\n          input-class=\"date-input input\"\n          :language=\"locale\"\n          :disabled-dates=\"{ days: [6, 0] }\"\n          :monday-first=\"true\"\n          format=\"yyyy-MM-dd\"\n          v-model=\"selectedEndDate\"\n        />\n      </div>\n      <text-field\n        class=\"flexrow-item overall-man-days\"\n        type=\"number\"\n        v-model=\"overallManDays\"\n        :label=\"$t('schedule.overall_man_days')\"\n        :disabled=\"!isCurrentUserAdmin\"\n        v-show=\"false\"\n      />\n      <combobox-number\n        class=\"flexrow-item zoom-level\"\n        :label=\"$t('schedule.zoom_level')\"\n        :options=\"zoomOptions\"\n        v-model=\"zoomLevel\"\n      />\n    </div>\n\n    <schedule\n      :start-date=\"startDate\"\n      :end-date=\"endDate\"\n      :hierarchy=\"scheduleItems\"\n      :zoom-level=\"zoomLevel\"\n      :is-loading=\"loading.schedule\"\n      :is-error=\"errors.schedule\"\n      :hide-man-days=\"true\"\n      @item-changed=\"scheduleItemChanged\"\n      @estimation-changed=\"estimationChanged\"\n      @change-zoom=\"changeZoom\"\n      @root-element-expanded=\"expandTaskTypeElement\"\n    />\n  </div>\n\n  <div\n    class=\"column side-column is-hidden-mobile hide-small-screen\"\n    v-if=\"currentTask\"\n  >\n    <task-info\n      :task=\"currentTask\"\n      :is-loading=\"false\"\n    />\n  </div>\n</div>\n\n</template>\n\n<script>\n/*\n * Page to manage the schedule of the big steps of the production. It allows\n * to set milestones too.\n */\nimport { mapGetters, mapActions } from 'vuex'\nimport moment from 'moment-timezone'\nimport { en, fr } from 'vuejs-datepicker/dist/locale'\nimport Datepicker from 'vuejs-datepicker'\n\nimport { sortTaskTypeScheduleItems } from '../../lib/sorting'\nimport { getTaskTypeSchedulePath } from '../../lib/path'\nimport { daysToMinutes, parseDate } from '../../lib/time'\n\nimport ComboboxNumber from '../widgets/ComboboxNumber'\nimport TaskInfo from '../sides/TaskInfo'\nimport TextField from '../widgets/TextField'\nimport Schedule from './schedule/Schedule'\n\nexport default {\n  name: 'production-schedule',\n  components: {\n    ComboboxNumber,\n    Datepicker,\n    Schedule,\n    TaskInfo,\n    TextField\n  },\n\n  data () {\n    return {\n      currentTask: null,\n      overallManDays: 0,\n      endDate: moment().add(6, 'months').endOf('day'),\n      scheduleItems: [],\n      startDate: moment().startOf('day'),\n      selectedStartDate: null,\n      selectedEndDate: null,\n      zoomLevel: 1,\n      zoomOptions: [\n        { label: 'Week', value: 0 },\n        { label: '1', value: 1 },\n        { label: '2', value: 2 },\n        { label: '3', value: 3 }\n      ],\n      loading: {\n        schedule: false\n      },\n      errors: {\n        schedule: false\n      }\n    }\n  },\n\n  mounted () {\n    this.reset()\n  },\n\n  computed: {\n    ...mapGetters([\n      'assetTypeMap',\n      'currentEpisode',\n      'currentProduction',\n      'isCurrentUserAdmin',\n      'isCurrentUserManager',\n      'isTVShow',\n      'organisation',\n      'taskTypeMap',\n      'user'\n    ]),\n\n    locale () {\n      if (this.user.locale === 'fr_FR') {\n        return fr\n      } else {\n        return en\n      }\n    }\n  },\n\n  methods: {\n    ...mapActions([\n      'editProduction',\n      'loadAssetTypeScheduleItems',\n      'loadEpisodeScheduleItems',\n      'loadMilestones',\n      'loadScheduleItems',\n      'loadSequenceScheduleItems',\n      'saveScheduleItem'\n    ]),\n\n    loadData () {\n      this.loading.schedule = true\n      this.loadScheduleItems(this.currentProduction)\n        .then(scheduleItems => {\n          const scheduleEndDate = parseDate(this.selectedEndDate)\n          scheduleItems = scheduleItems.map((item) => {\n            const taskType = this.taskTypeMap.get(item.task_type_id)\n            let startDate, endDate\n            if (item.start_date) {\n              startDate = parseDate(item.start_date)\n            } else {\n              startDate = moment()\n            }\n            if (startDate.isSameOrAfter(scheduleEndDate)) {\n              startDate = scheduleEndDate.clone().add(-1, 'days')\n            }\n\n            if (item.end_date) {\n              endDate = parseDate(item.end_date)\n            } else {\n              endDate = startDate.clone().add(1, 'days')\n            }\n            if (endDate.isSameOrAfter(scheduleEndDate)) {\n              endDate = scheduleEndDate.clone()\n            }\n\n            return {\n              ...item,\n              color: taskType.color,\n              for_entity: taskType.for_entity,\n              name: taskType.name,\n              priority: taskType.priority,\n              startDate: startDate,\n              endDate: endDate,\n              editable: this.isCurrentUserManager,\n              expanded: false,\n              loading: false,\n              route: getTaskTypeSchedulePath(\n                taskType.id,\n                this.currentProduction.id,\n                this.currentEpisode ? this.currentEpisode.id : null,\n                this.$tc(taskType.for_entity.toLowerCase(), 2)\n              ),\n              children: []\n            }\n          })\n          this.scheduleItems = sortTaskTypeScheduleItems(\n            scheduleItems,\n            this.currentProduction,\n            this.taskTypeMap\n          )\n          this.loading.schedule = false\n        })\n        .then(this.loadMilestones)\n        .catch((err) => {\n          console.error(err)\n          this.loading.schedule = false\n        })\n    },\n\n    changeZoom (event) {\n      if (event.wheelDelta < 0 && this.zoomLevel > 1) this.zoomLevel--\n      if (event.wheelDelta > 0 && this.zoomLevel < 3) this.zoomLevel++\n    },\n\n    reset () {\n      if (this.currentProduction.start_date) {\n        this.startDate =\n          parseDate(this.currentProduction.start_date)\n      }\n      if (this.currentProduction.end_date) {\n        this.endDate = parseDate(this.currentProduction.end_date)\n      }\n      this.overallManDays = this.currentProduction.man_days\n      this.selectedStartDate = this.startDate.toDate()\n      this.selectedEndDate = this.endDate.toDate()\n      this.loadData()\n    },\n\n    convertScheduleItems (taskTypeElement, scheduleItems) {\n      return scheduleItems.map((item) => {\n        let startDate, endDate\n        if (item.start_date) {\n          startDate = parseDate(item.start_date)\n        } else {\n          startDate = moment()\n        }\n        if (item.end_date) {\n          endDate = parseDate(item.end_date)\n        } else {\n          endDate = startDate.clone().add(1, 'days')\n        }\n        const scheduleItem = {\n          ...item,\n          startDate: startDate,\n          endDate: endDate,\n          expanded: false,\n          loading: false,\n          editable: this.isCurrentUserManager,\n          children: [],\n          parentElement: taskTypeElement\n        }\n        if (this.isTVShow) {\n          scheduleItem.route = getTaskTypeSchedulePath(\n            item.task_type_id,\n            this.currentProduction.id,\n            item.object_id,\n            this.$tc(taskTypeElement.for_entity.toLowerCase(), 2)\n          )\n        }\n        return scheduleItem\n      })\n    },\n\n    expandTaskTypeElement (taskTypeElement) {\n      const parameters = {\n        production: this.currentProduction,\n        taskType: this.taskTypeMap.get(taskTypeElement.task_type_id)\n      }\n\n      taskTypeElement.expanded = !taskTypeElement.expanded\n      if (taskTypeElement.expanded) {\n        taskTypeElement.loading = true\n        let action = 'loadAssetTypeScheduleItems'\n        if (taskTypeElement.for_entity === 'Shot') {\n          if (this.isTVShow) action = 'loadEpisodeScheduleItems'\n          else action = 'loadSequenceScheduleItems'\n        }\n\n        this[action](parameters)\n          .then((scheduleItems) => {\n            taskTypeElement.loading = false\n            taskTypeElement.children = this.convertScheduleItems(\n              taskTypeElement,\n              scheduleItems\n            )\n          })\n          .catch((err) => {\n            console.error(err)\n            taskTypeElement.loading = false\n            taskTypeElement.children = []\n          })\n      }\n    },\n\n    estimationChanged ({ item, days }) {\n      item.man_days = daysToMinutes(this.organisation, days)\n      this.saveScheduleItem(item)\n    },\n\n    scheduleItemChanged (item) {\n      if (item.startDate && item.endDate && item.parentElement) {\n        item.parentElement.startDate = this.getMinDate(item.parentElement)\n        item.parentElement.endDate = this.getMaxDate(item.parentElement)\n        this.saveScheduleItem(item.parentElement)\n      } else if (!item.parentElement) {\n        const minDate = this.getMinDate(item)\n        const maxDate = this.getMaxDate(item)\n        if (item.startDate.isAfter(minDate)) item.startDate = minDate\n        if (item.endDate.isBefore(maxDate)) {\n          item.endDate = maxDate.add(-1, 'days')\n        }\n      }\n      this.saveScheduleItem(item)\n    },\n\n    getMinDate (parentElement) {\n      let minDate = this.endDate.clone()\n      parentElement.children.forEach((item) => {\n        if (item.startDate && item.startDate.isBefore(minDate)) {\n          minDate = item.startDate\n        }\n      })\n      return minDate.clone()\n    },\n\n    getMaxDate (parentElement) {\n      let maxDate = this.startDate.clone()\n      parentElement.children.forEach((item) => {\n        if (item.endDate && item.endDate.isAfter(maxDate)) {\n          maxDate = item.endDate\n        }\n      })\n      return maxDate.clone()\n    }\n  },\n\n  socket: {\n  },\n\n  watch: {\n    selectedStartDate () {\n      this.startDate = parseDate(this.selectedStartDate)\n      this.editProduction({\n        ...this.currentProduction,\n        start_date: this.startDate.format('YYYY-MM-DD')\n      })\n    },\n\n    selectedEndDate () {\n      this.endDate = parseDate(this.selectedEndDate)\n      this.editProduction({\n        ...this.currentProduction,\n        end_date: this.endDate.format('YYYY-MM-DD')\n      })\n    },\n\n    overallManDays () {\n      if (this.overallManDays !== this.currentProduction.man_days) {\n        this.editProduction({\n          ...this.currentProduction,\n          man_days: this.overallManDays\n        })\n      }\n    },\n\n    currentProduction () {\n      this.reset()\n    }\n  },\n\n  metaInfo () {\n    if (this.isTVShow) {\n      return {\n        title: `${this.currentProduction ? this.currentProduction.name : ''}` +\n               ` - ${this.currentEpisode ? this.currentEpisode.name : ''}` +\n               ` | ${this.$t('schedule.title')} - Kitsu`\n      }\n    } else {\n      return {\n        title: `${this.currentProduction.name} ` +\n               `| ${this.$t('schedule.title')} - Kitsu`\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.dark {\n  .project-dates {\n    color: $white-grey;\n    border-bottom: 1px solid $grey;\n  }\n}\n\n.project-dates {\n  border-bottom: 1px solid #EEE;\n  padding-bottom: 1em;\n\n  .field {\n    padding-bottom: 0;\n    margin-bottom: 0;\n  }\n\n  .overall-man-days {\n    width: 120px;\n    font-size: 0.9em;\n    margin-right: 1em;\n  }\n}\n\n.fixed-page {\n  padding: 1em;\n  padding-top: 90px;\n  padding-left: 2em;\n}\n\n.main-column {\n  display: flex;\n  border: 0;\n  overflow: hidden;\n  flex-direction: column;\n}\n\n.zoom-level {\n  margin-top: -10px;\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProductionSchedule.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ProductionSchedule.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ProductionSchedule.vue?vue&type=template&id=81aeeeaa&scoped=true&\"\nimport script from \"./ProductionSchedule.vue?vue&type=script&lang=js&\"\nexport * from \"./ProductionSchedule.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ProductionSchedule.vue?vue&type=style&index=0&id=81aeeeaa&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"81aeeeaa\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}